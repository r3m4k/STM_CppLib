# Моя реализация ООП подхода для работы с STM32f3discovery

*Реализованная периферия:*
- Таймеры

# Сборка проекта

Проект использует систему сборки **GNU Make**. Основной управляющий файл — `Makefile.mk` в корневой директории. Конфигурация разделена на модули, расположенные в папке `./make/`.

## Структура файлов сборки

- **`Makefile.mk`** — Главный make-файл, объединяющий все модули и определяющий основные цели.    
- **`./make/`** — Директория с модульными файлами конфигурации:    
    - `make_args.mk` — Переменные и аргументы сборки.        
    - `make_utils.mk` — Вспомогательные функции и утилиты.        
    - `make_StmLib.mk` — Правила для сборки стандартной библиотеки STM32 (SPL).        
    - `make_UsbLib.mk` — Правила для сборки USB-библиотеки STM32.        
    - `make_user.mk` — Правила для сборки пользовательского кода.   

## Make Targets

Выполняются представленной командой из корня проекта:
`make -C ./make -f Makefile.mk [цель] SYSTEM=windows PROGRAM_NAME=project_name`

### Полная сборка и очистка проекта

| Цель              | Описание                                                                                                                  |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------- |
| **`build_all`**   | **Основная цель.** Создаёт необходимые директории, последовательно собирает все библиотеки и пользовательское приложение. |
| **`rebuild_all`** | Полная пересборка проекта. Сначала выполняет `clean_all`, затем `build_all`.                                              |
| **`clean_all`**   | Полная очистка проекта. Удаляет все скомпилированные объектные файлы, библиотеки и конечные исполняемые файлы.            |

### Работа с библиотеками (STM32 SPL и USB)

| Цель              | Описание                                                                                                         |
| ----------------- | ---------------------------------------------------------------------------------------------------------------- |
| **`build_libs`**  | Сборка обязательных библиотек для STM32F3: стандартную периферийную (SPL) и USB-библиотеку для микроконтроллера. |
| **`rebuild_lib`** | Принудительная пересборка всех библиотек.                                                                        |
| **`clean_libs`**  | Удаляет все скомпилированные файлы (`.o`, `.a`) только для библиотек.                                            |

### Сборка пользовательского приложения

| Цель               | Описание                                                                                                                              |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------- |
| **`build_user`**   | Собирает пользовательский код (исходные файлы `.c`/`.cpp`) и выполняет линковку с библиотеками для создания итогового файла прошивки. |
| **`rebuild_user`** | Принудительная пересборка пользовательского приложения.                                                                               |
| **`clean_user`**   | Удаляет скомпилированные объектные файлы и итоговые файлы прошивки, относящиеся к пользовательскому приложению.                       |
### Используемые переменные для сборки

Проект использует абсолютные пути, определенные в файле `make_args.mk`. **Для корректной сборки на новой машине необходимо обновить эти пути в соответствии с вашей локальной конфигурацией.**

| Переменная   | Значение по умолчанию                            | Описание                                                                                                                                                                                                     |
| ------------ | ------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `SOURCE_DIR` | `D:/Job/STM_Gyronavt`                            | **Корневая директория проекта.** Все относительные пути в make-файлах отсчитываются от этой директории.                                                                                                      |
| `GCC_PLACE`  | `C:/SysGCC/arm-eabi`                             | **Базовый путь к тулчейну (toolchain).**                                                                                                                                                                     |
| `CC`         | `${GCC_PLACE}/bin/arm-none-eabi-gcc`             | **Исполняемый файл компилятора языка C** для архитектуры ARM Cortex-M.                                                                                                                                       |
| `CP`         | `${GCC_PLACE}/bin/arm-none-eabi-g++`             | **Исполняемый файл компилятора языка C++** для архитектуры ARM Cortex-M.                                                                                                                                     |
| `LIBS`       | `-L${GCC_PLACE}/arm-none-eabi/arm/v5te/hard -lm` | **Параметры линковщика.** Указывает путь к библиотекам и явно подключает математическую библиотеку (`-lm`), скомпилированную для ARM с аппаратной поддержкой вычислений с плавающей точкой (hard float ABI). |
